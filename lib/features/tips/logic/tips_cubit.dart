import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_practice11/features/tips/models/tip_model.dart';
import 'package:uuid/uuid.dart';
import 'tips_state.dart';

class TipsCubit extends Cubit<TipsState> {
  TipsCubit() : super(const TipsState()) {
    _loadInitialTips();
  }

  final _uuid = const Uuid();

  void _loadInitialTips() {
    final initialTips = [
      TipModel(
        id: _uuid.v4(),
        title: 'Как правильно проверить уровень масла',
        content: '''Проверка уровня масла - важная процедура для здоровья двигателя.

Шаги проверки:
1. Прогрейте двигатель до рабочей температуры
2. Заглушите двигатель и подождите 5-10 минут
3. Достаньте масляный щуп и протрите его
4. Вставьте щуп обратно до упора
5. Снова достаньте и проверьте уровень

Уровень должен быть между отметками MIN и MAX. Если ниже MIN - долейте масло той же марки.

Проверяйте уровень масла каждые 1000 км пробега.''',
        category: 'Обслуживание',
        publishDate: DateTime.now().subtract(const Duration(days: 2)),
        imageUrl: 'https://cdn-icons-png.flaticon.com/512/2917/2917995.png',
        likes: 42,
      ),
      TipModel(
        id: _uuid.v4(),
        title: 'Когда менять тормозные колодки',
        content: '''Признаки износа тормозных колодок:

• Скрежет или визг при торможении
• Увеличенный тормозной путь
• Вибрация педали тормоза
• Сигнальная лампа на панели приборов

Рекомендации:
- Проверяйте толщину колодок каждые 10 000 км
- Минимальная толщина: 3 мм
- Меняйте колодки попарно (обе передние или обе задние)
- После замены обкатайте колодки 200-300 км

Средний срок службы: 30 000 - 70 000 км в зависимости от стиля вождения.''',
        category: 'Тормоза',
        publishDate: DateTime.now().subtract(const Duration(days: 5)),
        imageUrl: 'https://cdn-icons-png.flaticon.com/512/3774/3774278.png',
        likes: 38,
      ),
      TipModel(
        id: _uuid.v4(),
        title: 'Подготовка автомобиля к зиме',
        content: '''Чек-лист подготовки к зимнему сезону:

1. Шины
   - Установить зимнюю резину при температуре ниже +7°C
   - Проверить глубину протектора (мин. 4 мм)

2. Аккумулятор
   - Проверить заряд (должен быть не менее 12.5V)
   - Очистить клеммы от окисления

3. Жидкости
   - Заменить на зимнее масло
   - Залить незамерзающую жидкость
   - Проверить антифриз

4. Обогрев
   - Проверить работу печки
   - Протестировать обогрев заднего стекла

5. Дополнительно
   - Положить в багажник: скребок, щетку, трос, лопату''',
        category: 'Сезонное обслуживание',
        publishDate: DateTime.now().subtract(const Duration(days: 10)),
        imageUrl: 'https://cdn-icons-png.flaticon.com/512/2583/2583788.png',
        likes: 67,
      ),
      TipModel(
        id: _uuid.v4(),
        title: 'Экономия топлива: простые советы',
        content: '''10 способов снизить расход топлива:

1. Следите за давлением в шинах
   Недокачанные шины увеличивают расход на 3-5%

2. Избегайте резких ускорений
   Плавное вождение экономит до 20% топлива

3. Используйте круиз-контроль
   На трассе помогает поддерживать оптимальную скорость

4. Удалите лишний вес
   Каждые 50 кг увеличивают расход на 2%

5. Закрывайте окна на скорости
   Открытые окна создают сопротивление воздуха

6. Своевременное ТО
   Чистые фильтры и свежее масло = экономия

7. Планируйте маршрут
   Избегайте пробок и лишних километров

8. Выключайте кондиционер
   Когда он не нужен (расход +10-15%)

9. Не грейте двигатель долго
   1-2 минуты достаточно

10. Следите за аэродинамикой
    Снимайте багажник на крыше, когда не используете''',
        category: 'Экономия',
        publishDate: DateTime.now().subtract(const Duration(days: 15)),
        imageUrl: 'https://cdn-icons-png.flaticon.com/512/2922/2922506.png',
        likes: 89,
      ),
      TipModel(
        id: _uuid.v4(),
        title: 'Что проверить перед дальней поездкой',
        content: '''Чек-лист перед путешествием:

Технические проверки:
✓ Уровень всех жидкостей (масло, антифриз, тормозная, омыватель)
✓ Состояние и давление в шинах (включая запаску)
✓ Работа всех световых приборов
✓ Состояние щеток стеклоочистителя
✓ Заряд аккумулятора
✓ Тормозная система

Документы:
✓ Водительское удостоверение
✓ Свидетельство о регистрации
✓ Страховка (ОСАГО)
✓ Доверенность (если нужна)

В багажник:
✓ Запасное колесо и инструменты
✓ Аптечка, огнетушитель, знак аварийной остановки
✓ Трос, провода для прикуривания
✓ Фонарик, вода, еда
✓ Зарядка для телефона

Перед выездом:
✓ Спланируйте маршрут
✓ Проверьте прогноз погоды
✓ Отдохните, выспитесь
✓ Заправьте полный бак''',
        category: 'Путешествия',
        publishDate: DateTime.now().subtract(const Duration(days: 20)),
        imageUrl: 'https://cdn-icons-png.flaticon.com/512/3845/3845874.png',
        likes: 56,
      ),
    ];

    emit(state.copyWith(tips: initialTips));
  }

  void setCategory(String category) {
    emit(state.copyWith(selectedCategory: category));
  }

  void toggleLike(String tipId) {
    final updatedTips = state.tips.map((tip) {
      if (tip.id == tipId) {
        return tip.copyWith(
          isLiked: !tip.isLiked,
          likes: tip.isLiked ? tip.likes - 1 : tip.likes + 1,
        );
      }
      return tip;
    }).toList();

    emit(state.copyWith(tips: updatedTips));
  }
}


